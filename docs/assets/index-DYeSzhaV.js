var g=Object.defineProperty;var v=(i,e,t)=>e in i?g(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var a=(i,e,t)=>v(i,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const c of n.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function t(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(s){if(s.ep)return;s.ep=!0;const n=t(s);fetch(s.href,n)}})();async function b(i,e){let t;try{t=await fetch(i.toString(),e)}catch{throw new h(t,"Network error has occurred.")}let r;if(!t.ok){let s=t.statusText;try{r=await t.json(),s=r.error&&r.error.message||r.data&&r.data.error&&r.data.error.message||s}catch{}let n=`Error ${t.status}: ${s}`;throw new h(t,r,n)}try{return await t.json()}catch(s){throw new h(t,null,s.message)}}class h extends Error{constructor(t,r,s){super(s);a(this,"name","FetchError");this.response=t,this.body=r}}window.addEventListener("unhandledrejection",i=>{i.reason instanceof h&&console.error(i.reason.message)});const E="_card_container_1whgy_1",P="_selected_1whgy_4",w="_card_1whgy_1",x="_card_back_1whgy_20",k="_card_front_1whgy_20",L="_title_1whgy_50",I="_image_1whgy_82",S="_image_front_1whgy_90",o={card_container:E,selected:P,card:w,card_back:x,card_front:k,title:L,image:I,image_front:S};class C{constructor({fullName:e=null,image:t=null},r,s,n){a(this,"card_container");this.fullName=e,this.image=t,this.el=r,this.index=s,this.key=n,this.render(),this._initEvents()}_initEvents(){this.card_container.addEventListener("click",this._onClick)}_onClick(e){if(e.currentTarget.classList.contains(o.selected))return;const t=new CustomEvent("cardClicked",{detail:{key:e.currentTarget.getAttribute("data-key"),index:e.currentTarget.getAttribute("data-index")}});document.dispatchEvent(t)}selectCard(){this.card_container.classList.add(o.selected)}unSelectCard(){this.card_container.classList.remove(o.selected)}render(){if(!this.fullName||!this.image)return null;this.card_container=document.createElement("div"),this.card_container.classList.add(o.card_container),this.card_container.setAttribute("data-index",this.index),this.card_container.setAttribute("data-key",this.key);const e=document.createElement("div");e.classList.add(o.card);const t=document.createElement("div");t.classList.add(o.card_front);const r=document.createElement("img");r.setAttribute("src","./images/card.png"),r.classList.add(o.image_front),t.append(r);const s=document.createElement("div");s.classList.add(o.card_back);const n=document.createElement("div");n.classList.add(o.title);const c=document.createElement("h3");c.textContent=this.fullName,n.append(c);const l=document.createElement("img");l.setAttribute("src",this.image),l.classList.add(o.image),s.append(n),s.append(l),e.append(t),e.append(s),this.card_container.append(e),this.el.append(this.card_container)}doEmpty(){this.card_container.removeEventListener("click",this._onClick),this.card_container.innerHTML=""}_remove(){this.card_container.remove()}destroy(){this.card_container.removeEventListener("click",this._onClick),this._remove()}}const q="_cards_1wzoi_1",T={cards:q},M="_popupPersona_18qpb_1",j="_fadeIn_18qpb_1",O="_popupPersona__img_18qpb_26",B="_popupPersona__text_18qpb_34",$="_popupPersona__actions_block_18qpb_64",A="_popupPersona__close_18qpb_75",N="_popupPersona__btn_18qpb_106",G="_persona__overlay_layer_unique_18qpb_193",H="_changeBgr_18qpb_1",K="___select_18qpb_206",D="___select__title_18qpb_214",F="___select__content_18qpb_227",R="___select__label_18qpb_232",U="___select__input_18qpb_232",W="_reset_18qpb_275",z="_container_18qpb_356",J="_control_group_18qpb_366",d={popupPersona:M,fadeIn:j,popupPersona__img:O,popupPersona__text:B,popupPersona__actions_block:$,popupPersona__close:A,popupPersona__btn:N,persona__overlay_layer_unique:G,changeBgr:H,__select:K,__select__title:D,__select__content:F,__select__label:R,__select__input:U,reset:W,container:z,control_group:J};class Q{constructor(e){a(this,"element",null);a(this,"subElements",{});a(this,"onDocumentClick",e=>{switch(e.target.dataset.personael){case"cclose":this.destroy();break;case"doaction":const s=new CustomEvent("GAME/updateNames",{detail:{name1:this.subElements.player1.value||"",name2:this.subElements.player2.value||""}});document.dispatchEvent(s),this.callback(),this.destroy();break}});this.callback=e,this.render()}get template(){return`
                <div class="${d.popupPersona}">
                    <div class="${d.popupPersona__text}">
                        <div class="${d.container}">
                          <h1>Укажи имена игроков</h1>
                        
                          <div class="${d.control_group}">
                            <input id="firstname1" type="text" name="firstname" placeholder="Введи своё имя" />
                        
                            <label for="firstname1">
                              <span>Никнейм Игрока 1</span>
                            </label>
                          </div>
                          
                            <div class="${d.control_group}">
                            <input id="firstname2" type="text" name="firstname" placeholder="Введи своё имя" />
                        
                            <label for="firstname2">
                              <span>Никнейм Игрока 2</span>
                            </label>
                          </div>                   
                        <div class="${d.popupPersona__actions_block}">                
                            <div class="${d.popupPersona__btn}"><a data-personael="doaction" href="#">Играть!</a></div>          
                        </div>
                        </div>                        
                    </div>
                </div>           
            `}render(){const e=document.createElement("div");e.innerHTML=this.template,this.element=e.firstElementChild,this.subElements.player1=this.element.querySelector("#firstname1"),this.subElements.player2=this.element.querySelector("#firstname2"),this.initEventListeners(),this.createOverlay()}initEventListeners(){document.addEventListener("click",this.onDocumentClick,!0)}remove(){setTimeout(()=>this.element.remove(),300),this.removeOverlay(),document.removeEventListener("click",this.onDocumentClick,!0)}createOverlay(){this.overlayEl=document.createElement("section"),this.overlayEl.classList.add(d.persona__overlay_layer_unique),document.body.append(this.overlayEl)}removeOverlay(){this.overlayEl&&this.overlayEl.remove()}destroy(){this.remove()}}const u=3,y=8,p=class p{constructor(e){a(this,"characters",[]);a(this,"cards",{});a(this,"selectedIndex");a(this,"isBusy",!1);a(this,"totalScore");a(this,"pl1",{name:"Игрок 1",score:0});a(this,"pl2",{name:"Игрок 2",score:0});a(this,"players",[]);a(this,"activePlayerIndex",0);p.instance&&this.destroy(),p.instance=this,this.el=e,this.startGame(),this._initEvents(),this.score1=document.getElementById("js-score_1"),this.score2=document.getElementById("js-score_2"),this.name1=document.getElementById("js-name_1"),this.name2=document.getElementById("js-name_2")}_initEvents(){document.addEventListener("cardClicked",e=>{if(this.isBusy)return;const t=e.detail.index,r=e.detail.key;this.cards[t][r].selectCard(),this.selectedIndex&&this.selectedIndex===t?(this.isBusy=!0,window.setTimeout(()=>{for(const s of Object.keys(this.cards[t]))this.cards[t][s].doEmpty();this.selectedIndex=null,this.selectedKey=null,this.isBusy=!1,this._increaseScore(),++this.totalScore===Math.floor(u*y)/2&&this.finishGame()},1500)):this.selectedIndex&&this.selectedIndex!==t?(this.isBusy=!0,window.setTimeout(()=>{this.cards[t][r].unSelectCard(),this.cards[this.selectedIndex][this.selectedKey].unSelectCard(),this.selectedIndex=null,this.selectedKey=null,this.isBusy=!1,this._changePlayer()},1e3)):(this.selectedIndex=t,this.selectedKey=r)}),document.addEventListener("GAME/nextUser",e=>{this._changePlayer()}),document.addEventListener("GAME/updateNames",e=>{this.name1.innerHTML=e.detail.name1||this.pl1.name,this.name2.innerHTML=e.detail.name2||this.pl2.name,e.detail.name1&&(this.pl1.name=e.detail.name1),e.detail.name2&&(this.pl2.name=e.detail.name2)})}_increaseScore(){this.players[this.activePlayerIndex].score++;debugger;this.score1.innerHTML=this.players[0].score.toString(),this.score2.innerHTML=this.players[1].score.toString()}_changePlayer(){this.activePlayerIndex=this.players.length-1===this.activePlayerIndex?0:this.activePlayerIndex+1,alert(`Сейчас ходит ${this.players[this.activePlayerIndex].name}`)}finishGame(){alert("game finished")}startGame(){const e=new Q(this._start.bind(this));document.body.append(e.element)}async _start(){this.players=[this.pl1,this.pl2],this.characters=await this._getApiCharacters(),this._renderCards()}async _getApiCharacters(){let e=[];try{e=await b("https://potterapi-fedeperin.vercel.app/en/characters",{method:"GET"})}catch(t){console.error("something went wrong",t)}return e}_getRandomIndexes(e){let t=e||[];return e||(t=Array((e==null?void 0:e.length)||this.characters.length).fill().map((r,s)=>s++)),t.length?(t.sort(()=>.5-Math.random()),t):[Math.floor(Math.random()*(e==null?void 0:e.length)||this.characters.length)]}_renderCards(){const e=document.createElement("div");e.classList.add(T.cards);let t,r;window.matchMedia("(min-width: 768.1px)").matches?(t=u,r=y):(t=6,r=3),e.style.setProperty("--cards-columns",r),e.style.setProperty("--cards-rows",t);const s=t*r,n=this._getRandomIndexes().splice(0,s/2),c=[...n,...n];let l=0;for(const _ of this._getRandomIndexes(c))this.characters[_]&&((typeof this.cards[_.toString()]!="object"||typeof this.cards[_.toString()]===null)&&(this.cards[_.toString()]={}),this.cards[_.toString()][l.toString()]=new C(this.characters[_],e,_,l),l++);this.el.append(e)}_remove(){this.el.remove()}destroy(){for(const e of Object.keys(this.cards))Object.keys(e).forEach(t=>e[t].destroy());this._remove()}};a(p,"instance");let m=p;const f="js_gameSpace";document.querySelector("#app").innerHTML=`
  <header class="header">
    <div class="header__title title"><h1> Harry Potter Memo Game</h1></div>

    <div class="header__score header__score_1 score"><span id="js-name_1"></span><br><span id="js-score_1">0</span></div>
    <div class="header__score header__score_2 score"><span id="js-name_2"></span><br><span id="js-score_2">0</span></div>
    
  </header>
  <section class="root">    
    <div class="gameSpace" id="${f}">
    </div>
  </section>
  <footer class="footer"> GS 2024 </footer>
`;new m(document.querySelector(`#${f}`));
