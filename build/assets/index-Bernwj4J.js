var f=Object.defineProperty;var p=(i,e,t)=>e in i?f(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var d=(i,e,t)=>p(i,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const c of n.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function t(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(s){if(s.ep)return;s.ep=!0;const n=t(s);fetch(s.href,n)}})();async function g(i,e){let t;try{t=await fetch(i.toString(),e)}catch{throw new m(t,"Network error has occurred.")}let r;if(!t.ok){let s=t.statusText;try{r=await t.json(),s=r.error&&r.error.message||r.data&&r.data.error&&r.data.error.message||s}catch{}let n=`Error ${t.status}: ${s}`;throw new m(t,r,n)}try{return await t.json()}catch(s){throw new m(t,null,s.message)}}class m extends Error{constructor(t,r,s){super(s);d(this,"name","FetchError");this.response=t,this.body=r}}window.addEventListener("unhandledrejection",i=>{i.reason instanceof m&&console.error(i.reason.message)});const y="_card_container_1l9b5_1",v="_selected_1l9b5_4",b="_card_1l9b5_1",E="_card_back_1l9b5_26",w="_card_front_1l9b5_26",x="_title_1l9b5_49",k="_image_1l9b5_81",L="_image_front_1l9b5_89",a={card_container:y,selected:v,card:b,card_back:E,card_front:w,title:x,image:k,image_front:L};class C{constructor({fullName:e=null,image:t=null},r,s,n){d(this,"card_container");this.fullName=e,this.image=t,this.el=r,this.index=s,this.key=n,this.render(),this._initEvents()}_initEvents(){this.card_container.addEventListener("click",this._onClick)}_onClick(e){if(e.currentTarget.classList.contains(a.selected))return;const t=new CustomEvent("cardClicked",{detail:{key:e.currentTarget.getAttribute("data-key"),index:e.currentTarget.getAttribute("data-index")}});document.dispatchEvent(t)}selectCard(){this.card_container.classList.add(a.selected)}unSelectCard(){this.card_container.classList.remove(a.selected)}render(){if(!this.fullName||!this.image)return null;this.card_container=document.createElement("div"),this.card_container.classList.add(a.card_container),this.card_container.setAttribute("data-index",this.index),this.card_container.setAttribute("data-key",this.key);const e=document.createElement("div");e.classList.add(a.card);const t=document.createElement("div");t.classList.add(a.card_front);const r=document.createElement("img");r.setAttribute("src","./images/card.png"),r.classList.add(a.image_front),t.append(r);const s=document.createElement("div");s.classList.add(a.card_back);const n=document.createElement("div");n.classList.add(a.title);const c=document.createElement("h3");c.textContent=this.fullName,n.append(c);const o=document.createElement("img");o.setAttribute("src",this.image),o.classList.add(a.image),s.append(n),s.append(o),e.append(t),e.append(s),this.card_container.append(e),this.el.append(this.card_container)}doEmpty(){this.card_container.removeEventListener("click",this._onClick),this.card_container.innerHTML=""}_remove(){this.card_container.remove()}destroy(){this.card_container.removeEventListener("click",this._onClick),this._remove()}}const I="_cards_1kana_1",S={cards:I},h=class h{constructor(e){d(this,"characters",[]);d(this,"cards",{});d(this,"selectedIndex");d(this,"isBusy",!1);d(this,"player_1");h.instance&&this.destroy(),h.instance=this,this.el=e,this.startGame(),this._initEvents()}_initEvents(){document.addEventListener("cardClicked",e=>{if(this.isBusy)return;const t=e.detail.index,r=e.detail.key;this.cards[t][r].selectCard(),this.selectedIndex&&this.selectedIndex===t?(this.isBusy=!0,window.setTimeout(()=>{for(const s of Object.keys(this.cards[t]))this.cards[t][s].doEmpty();this.selectedIndex=null,this.selectedKey=null,this.isBusy=!1},1500)):this.selectedIndex&&this.selectedIndex!==t?(this.isBusy=!0,window.setTimeout(()=>{this.cards[t][r].unSelectCard(),this.cards[this.selectedIndex][this.selectedKey].unSelectCard(),this.selectedIndex=null,this.selectedKey=null,this.isBusy=!1},1e3)):(this.selectedIndex=t,this.selectedKey=r)})}startGame(){this._start()}async _start(){this.characters=await this._getApiCharacters(),this._renderCards()}async _getApiCharacters(){let e=[];try{e=await g("https://potterapi-fedeperin.vercel.app/en/characters",{method:"GET"})}catch(t){console.error("something went wrong",t)}return e}_getRandomIndexes(e){let t=e||[];return e||(t=Array((e==null?void 0:e.length)||this.characters.length).fill().map((r,s)=>s++)),t.length?(t.sort(()=>.5-Math.random()),t):[Math.floor(Math.random()*(e==null?void 0:e.length)||this.characters.length)]}_renderCards(){const e=document.createElement("div");e.classList.add(S.cards);let t,r;window.matchMedia("(min-width: 768.1px)").matches?(t=3,r=6):(t=6,r=3);const s=t*r,n=this._getRandomIndexes().splice(0,s/2),c=[...n,...n];let o=0;for(const l of this._getRandomIndexes(c))this.characters[l]&&((typeof this.cards[l.toString()]!="object"||typeof this.cards[l.toString()]===null)&&(this.cards[l.toString()]={}),this.cards[l.toString()][o.toString()]=new C(this.characters[l],e,l,o),o++);this.el.append(e)}_remove(){this.el.remove()}destroy(){for(const e of Object.keys(this.cards))Object.keys(e).forEach(t=>e[t].destroy());this._remove()}};d(h,"instance");let u=h;const _="js_gameSpace";document.querySelector("#app").innerHTML=`
  <header class="header">
    <div class="header__title title"><h1> Harry Potter Memo Game</h1></div>
    <div class="header__score score">Score:<br><span class="js-score"></span></div>
    <div class="header__name name js-name"></div>
  </header>
  <section class="root">    
    <div class="gameSpace" id="${_}">
    </div>
  </section>
  <footer class="footer"> Footer </footer>
`;new u(document.querySelector(`#${_}`));
